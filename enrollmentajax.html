<!DOCTYPE html>
<html lang="en">
<head>
    <title>Index</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm" style="height: 80px; padding: 10px 20px;">
      <div class="container-fluid">
        <a class="navbar-brand text-white fw-bold" style="font-size: 30px; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;" href="#">
          ABZ Zakria
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center" id="collapsibleNavbar">
          <ul class="navbar-nav" style="font-size: 18px; gap: 25px;">
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="regionajax.html">Region</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="districtajax.html">District</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="talukaajax.html">Taluka</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="demanderajax.html">Demander_view</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="enrollmentajax.html">Enrollment_view</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="reportajax.html">Report_view</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    <script src="livesupportlibrary.js"></script>
    <script>
        $(document).ready(function(){
            load();  
            $("#region").live('change', function(){
                var regionid = $("#region").val();
                $.ajax({
                    url:'enrollmentview.php',
                    type: 'get',
                    data: 'regionid=' + regionid,
                    success: function(data){
                        $("#districtview").html(data);
                    }
                });
            });  
            
            $("#district").live('change', function(){
                var district = $("#district").val();
                $.ajax({
                    url: 'enrollmentview.php',
                    type: 'get',
                    data: 'districtid=' + district,
                    success: function(data){
                        $("#talukaview").html(data);
                    }
                });
            });   

            $("#taluka").live('change', function(){
                var taluka = $("#taluka").val();
                $.ajax({
                    url: 'enrollmentview.php',
                    type: 'get',
                    data: 'talukaid=' + taluka,
                    success: function(data){
                        $("#demanderview").html(data);
                    }
                });
            });

            $("#demander").live('change', function(){
                var demanderid = $("#demander").val();
                demander(demanderid);
            });
 
            $(document).on('click', '#submitbtn', function(event){
                var demanderid = $("#demander").val();
                var formData = [];
                var classes = ["kachi", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX-Biology Group", "IX-Computer Group", "IX-Gender Group", "X-Biology Group", "X-Computer Group", "X-Gender Group"];
                
                // Collect only filled fields
                $("tr").each(function(index) {
                    if (index > 1) { // Skip header rows
                        var classData = {
                            class: classes[index-2],
                            sindhi: {},
                            urdu: {},
                            english: {}
                        };
                        
                        // Check Sindhi medium
                        if ($(this).find("input[name='sindhi_total[]']").val() > 0) {
                            classData.sindhi = {
                                total: $(this).find("input[name='sindhi_total[]']").val(),
                                male: $(this).find("input[name='sindhi_male[]']").val(),
                                female: $(this).find("input[name='sindhi_female[]']").val(),
                                muslim: $(this).find("input[name='sindhi_muslim[]']").val(),
                                nonmuslim: $(this).find("input[name='sindhi_nonmuslim[]']").val()
                            };
                        }
                        
                        // Check Urdu medium
                        if ($(this).find("input[name='urdu_total[]']").val() > 0) {
                            classData.urdu = {
                                total: $(this).find("input[name='urdu_total[]']").val(),
                                male: $(this).find("input[name='urdu_male[]']").val(),
                                female: $(this).find("input[name='urdu_female[]']").val(),
                                muslim: $(this).find("input[name='urdu_muslim[]']").val(),
                                nonmuslim: $(this).find("input[name='urdu_nonmuslim[]']").val()
                            };
                        }
                        
                        // Check English medium
                        if ($(this).find("input[name='english_total[]']").val() > 0) {
                            classData.english = {
                                total: $(this).find("input[name='english_total[]']").val(),
                                male: $(this).find("input[name='english_male[]']").val(),
                                female: $(this).find("input[name='english_female[]']").val(),
                                muslim: $(this).find("input[name='english_muslim[]']").val(),
                                nonmuslim: $(this).find("input[name='english_nonmuslim[]']").val(),
                                engurdu: $(this).find("input[name='english_engurdu[]']").val(),
                                engsindhi: $(this).find("input[name='english_engsindhi[]']").val()
                            };
                        }
                        
                        // Only add if at least one medium has data
                        if (Object.keys(classData.sindhi).length > 0 || 
                            Object.keys(classData.urdu).length > 0 || 
                            Object.keys(classData.english).length > 0) {
                            formData.push(classData);
                        }
                    }
                });
                
                // Submit data
                $.ajax({
                    url: 'enrollmentview.php',
                    type: 'post',
                    data: {
                        demanderid: demanderid,
                        enrollment: formData,
                        add: 'add'
                    },
                    success: function(response) {
                        alert("Data submitted successfully!");
                    $("#roportview").html(response);

                    },
                    error: function() {
                        alert("Error submitting data");
                    }
                });
            });
        });

        function demander(demanderid) {
            $.ajax({
                url: 'enrollmentview.php',
                type: 'get',
                data: 'demanderid=' + demanderid,
                success: function(data) {
                    $("#enrollmentview").html(data);
                }
            });
        }
        
        function load() {
            $.ajax({
                url:'enrollmentview.php',
                type: 'get',
                data: 'load=load',
                success: function(data) {
                    $("#view").html(data);
                }
            });
        }
    </script>
    
    <p id='view'></p>
    <p id='districtview'></p>
    <p id='talukaview'></p>
    <p id='demanderview'></p>
    <p id='enrollmentview'></p>
    <p id='mediamview'></p>
    <p id='roportview'></p>
</body>
</html>