<!DOCTYPE html>
<html lang="en">
<head>
    <title>Index</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm" style="height: 80px; padding: 10px 20px;">
      <div class="container-fluid">
        <a class="navbar-brand text-white fw-bold" style="font-size: 30px; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;" href="#">
          ABZ Zakria
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center" id="collapsibleNavbar">
          <ul class="navbar-nav" style="font-size: 18px; gap: 25px;">
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="regionajax.html">Region</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="districtajax.html">District</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="talukaajax.html">Taluka</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="demanderajax.html">Demander_view</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="enrollmentajax.html">Enrollment_view</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light fw-semibold" href="reportajax.html">Report_view</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    <script src="livesupportlibrary.js"></script>
    <script>
          $(document).ready(function(){
            load();  
            $("#region").live('change', function(){
                var regionid = $("#region").val();
                $.ajax({
                    url: 'reportview.php',
                    type: 'get',
                    data: 'regionid=' + regionid,
                    success: function(data){
                        $("#districtview").html(data);
                    }
                });
            });  
            
            $("#district").live('change', function(){
                var district = $("#district").val();
                $.ajax({
                    url: 'reportview.php',
                    type: 'get',
                    data: 'districtid=' + district,
                    success: function(data){
                        $("#talukaview").html(data);
                    }
                });
            });   

            $("#taluka").live('change', function(){
                var taluka = $("#taluka").val();
                $.ajax({
                    url: 'reportview.php',
                    type: 'get',
                    data: 'talukaid=' + taluka,
                    success: function(data){
                        $("#demanderview").html(data);
                    }
                });
            });

            $("#demander").live('change', function(){
                var demanderid = $("#demander").val();
                demander(demanderid);
            });


 $(document).on('click', '.updatebtn', function() {  
    var demanderid = $(this).data('demanderid');
    var data = {};

    // Define field mappings from input IDs to database columns
    var fieldMap = {
        'total': 'enrollment_no_of_students',
        'male': 'no_of_boys',
        'female': 'no_of_girls',
        'muslim': 'no_of_muslims',
        'nonmuslim': 'no_of_nomuslims',
        'urdu': 'urdu',
        'sindhi': 'sindhi'
    };

    $("table tr").each(function(index, row) {
        if (index > 1) { // Skip header rows
            $(row).find("input[type='number']").each(function() {
                var input = $(this);
                var idParts = input.attr('id').split('_');
                var fieldName = idParts[1];
                var enrollmentid = idParts[2];
                var dbField = fieldMap[fieldName];

                if (!dbField) {
                    console.error('Unknown field:', fieldName);
                    return;
                }

                if (!data[enrollmentid]) {
                    data[enrollmentid] = {};
                }
                data[enrollmentid][dbField] = input.val();
            });
        }
    });

    // Send data via AJAX
    $.ajax({
        type: "POST",
        url: "reportview.php",
        data: {
            demanderid: demanderid,
            data: data
        },
        success: function(response) {
            alert(response);
            $("#updateview").html(response);
        }
    });
});

            })// end update function ..
 
            
        function demander(demanderid) {
            $.ajax({
                url: 'reportview.php',
                type: 'get',
                data: 'demanderid=' + demanderid,
                success: function(data) {
                    $("#enrollmentview").html(data);
                }
            });
        }
        
        function load() {
            $.ajax({
                url: 'reportview.php',
                type: 'get',
                data: 'load=load',
                success: function(data) {
                    $("#view").html(data);
                }
            });
        }
    </script>
    
    <p id='view'></p>
    <p id='districtview'></p>
    <p id='talukaview'></p>
    <p id='demanderview'></p>
    <p id='enrollmentview'></p>
    <p id='mediamview'></p>
    <p id='reportview'></p>
    <p id='updateview'></p>
</body>
</html>